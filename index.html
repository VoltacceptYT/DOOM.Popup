<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WebLyne DOOMÂ®</title>
  <style>
    html,
    body {
      height: 100%;
      width: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: #111;
    }

    body {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      width: 100vw;
      height: 100vh;
      min-width: 100vw;
      min-height: 100vh;
      display: flex;
      align-items: stretch;
      justify-content: stretch;
    }

    .weblyne-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      min-width: 100vw;
      min-height: 100vh;
      max-width: 100vw;
      max-height: 100vh;
      display: block;
      image-rendering: pixelated;
      outline: none;
      border: none;
      margin: 0;
      padding: 0;
      background: transparent;
      z-index: 1;
    }

    #status, #progress {
      position: absolute;
      z-index: 2;
      left: 50%;
      top: 5%;
      transform: translateX(-50%);
      color: #fff;
      background: rgba(0,0,0,0.7);
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 1.1em;
      text-align: center;
      pointer-events: none;
    }

    #progress {
      top: 10%;
      width: 300px;
      max-width: 80vw;
      background: rgba(0,0,0,0.8);
    }
  </style>
</head>

<body>
  <div id="status">Downloading...</div>
  <progress id="progress" value="0" max="100" hidden></progress>
  <canvas class="weblyne-canvas" id="canvas" oncontextmenu="event.preventDefault()" tabindex="-1"></canvas>

  <script>
    const canvas = document.getElementById("canvas");
    const statusElement = document.getElementById("status");
    const progressElement = document.getElementById("progress");

    // Resize canvas to always cover the viewport
    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      canvas.style.width = window.innerWidth + "px";
      canvas.style.height = window.innerHeight + "px";
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    var Module = {
      keyboardListeningElement: window,
      arguments: [],
      preRun: [
        function () {
          SDL.defaults.copyOnLock = false;
        },
      ],
      postRun: [],
      canvas: canvas,
      setStatus: function (text) {
        if (!Module.setStatus.last)
          Module.setStatus.last = { time: Date.now(), text: "" };
        if (text === Module.setStatus.last.text) return;
        const m = text.match(/([^(]+)$$(\d+(\.\d+)?)\/(\d+)$$/);
        const now = Date.now();
        if (m && now - Module.setStatus.last.time < 30) return;
        Module.setStatus.last.time = now;
        Module.setStatus.last.text = text;
        if (m) {
          text = m[1];
          progressElement.value = parseInt(m[2]) * 100;
          progressElement.max = parseInt(m[4]) * 100;
          progressElement.hidden = false;
        } else {
          progressElement.value = null;
          progressElement.max = null;
          progressElement.hidden = true;
        }
        statusElement.innerHTML = text;
      },
      totalDependencies: 0,
      monitorRunDependencies: function (left) {
        this.totalDependencies = Math.max(this.totalDependencies, left);
        Module.setStatus(
          left
            ? "Preparing... (" +
            (this.totalDependencies - left) +
            "/" +
            this.totalDependencies +
            ")"
            : "All downloads complete.",
        );
      },
    };
    Module.setStatus("Downloading ...");
    window.onerror = function () {
      Module.setStatus("Exception thrown, see JavaScript console");
      Module.setStatus = function (text) {
        if (text) Module.printErr("[post-exception status] " + text);
      };
    };
  </script>
  <script async type="text/javascript" src="index.js"></script>
</body>

  </html>
